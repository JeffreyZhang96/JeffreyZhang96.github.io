<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VuePress</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/assets/css/0.styles.57314520.css" as="style"><link rel="preload" href="/assets/js/app.8e528a8b.js" as="script"><link rel="preload" href="/assets/js/3.82a49c19.js" as="script"><link rel="preload" href="/assets/js/1.0ab98803.js" as="script"><link rel="preload" href="/assets/js/26.3968f588.js" as="script"><link rel="prefetch" href="/assets/js/10.0d102bea.js"><link rel="prefetch" href="/assets/js/11.5e4a2761.js"><link rel="prefetch" href="/assets/js/12.aef8f1f6.js"><link rel="prefetch" href="/assets/js/13.5b2c2445.js"><link rel="prefetch" href="/assets/js/14.9521dcbd.js"><link rel="prefetch" href="/assets/js/15.fa9dfeb1.js"><link rel="prefetch" href="/assets/js/16.695eba2a.js"><link rel="prefetch" href="/assets/js/17.a39d0ec9.js"><link rel="prefetch" href="/assets/js/18.b8b9dd64.js"><link rel="prefetch" href="/assets/js/19.d5b22499.js"><link rel="prefetch" href="/assets/js/20.b157b0b0.js"><link rel="prefetch" href="/assets/js/21.a122ea90.js"><link rel="prefetch" href="/assets/js/22.7fa65ea5.js"><link rel="prefetch" href="/assets/js/23.a95127d1.js"><link rel="prefetch" href="/assets/js/24.4c905bc9.js"><link rel="prefetch" href="/assets/js/25.231023bd.js"><link rel="prefetch" href="/assets/js/27.bf6ef3e7.js"><link rel="prefetch" href="/assets/js/28.076b9ccc.js"><link rel="prefetch" href="/assets/js/29.dae1a67e.js"><link rel="prefetch" href="/assets/js/30.4257dfcc.js"><link rel="prefetch" href="/assets/js/31.685a3d09.js"><link rel="prefetch" href="/assets/js/32.b518b57c.js"><link rel="prefetch" href="/assets/js/4.542f8749.js"><link rel="prefetch" href="/assets/js/5.300a1aac.js"><link rel="prefetch" href="/assets/js/6.e09b9417.js"><link rel="prefetch" href="/assets/js/7.84bad2f8.js"><link rel="prefetch" href="/assets/js/8.4fe02f1b.js"><link rel="prefetch" href="/assets/js/9.6d6b0fe4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.57314520.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-418054de><div data-v-418054de><div id="loader-wrapper" class="loading-wrapper" data-v-71fac282 data-v-418054de data-v-418054de><div class="loader-main" data-v-71fac282><div data-v-71fac282></div><div data-v-71fac282></div><div data-v-71fac282></div><div data-v-71fac282></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-5d8855ac data-v-418054de data-v-418054de><h3 class="title" style="display:none;" data-v-5d8855ac data-v-5d8855ac></h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-5d8855ac data-v-5d8855ac><input type="password" value="" data-v-5d8855ac> <span data-v-5d8855ac>Konck! Knock!</span> <button data-v-5d8855ac>OK</button></label> <div class="footer" style="display:none;" data-v-5d8855ac data-v-5d8855ac><span data-v-5d8855ac><i class="iconfont reco-theme" data-v-5d8855ac></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-5d8855ac>vuePress-theme-reco</a></span> <span data-v-5d8855ac><i class="iconfont reco-copyright" data-v-5d8855ac></i> <a data-v-5d8855ac><!---->
            
          <!---->
          2020
        </a></span></div></div> <div class="hide" data-v-418054de><header class="navbar" data-v-418054de><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="" class="logo"> <!----></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      基础
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/HTML/" class="nav-link"><i class="iconfont undefined"></i>
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/CSS/" class="nav-link"><i class="iconfont undefined"></i>
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/" class="nav-link"><i class="iconfont undefined"></i>
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/TypeScript/" class="nav-link"><i class="iconfont undefined"></i>
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      通识
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/算法/" class="nav-link"><i class="iconfont undefined"></i>
  算法
</a></li><li class="dropdown-item"><!----> <a href="/网络/" class="nav-link"><i class="iconfont undefined"></i>
  网络
</a></li><li class="dropdown-item"><!----> <a href="/浏览器/" class="nav-link"><i class="iconfont undefined"></i>
  浏览器
</a></li><li class="dropdown-item"><!----> <a href="/操作系统/" class="nav-link"><i class="iconfont undefined"></i>
  操作系统
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      框架
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Vue/" class="nav-link"><i class="iconfont undefined"></i>
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/React/" class="nav-link"><i class="iconfont undefined"></i>
  React
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      高级
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NodeJS/" class="nav-link"><i class="iconfont undefined"></i>
  NodeJS
</a></li><li class="dropdown-item"><!----> <a href="/数据库/" class="nav-link"><i class="iconfont undefined"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/优化/" class="nav-link"><i class="iconfont undefined"></i>
  优化
</a></li><li class="dropdown-item"><!----> <a href="/安全/" class="nav-link"><i class="iconfont undefined"></i>
  安全
</a></li><li class="dropdown-item"><!----> <a href="/图形/" class="nav-link"><i class="iconfont undefined"></i>
  图形
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      工具
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/webpack/" class="nav-link"><i class="iconfont undefined"></i>
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/git/" class="nav-link"><i class="iconfont undefined"></i>
  git
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      项目
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mimall/" class="nav-link"><i class="iconfont undefined"></i>
  vue-mimall
</a></li><li class="dropdown-item"><!----> <a href="/weibo/" class="nav-link"><i class="iconfont undefined"></i>
  koa2-weibo
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/JeffreyZhang96" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-418054de></div> <aside class="sidebar" data-v-418054de><div class="personal-info-wrapper" data-v-949f496c><!----> <!----> <div class="num" data-v-949f496c><div data-v-949f496c><h3 data-v-949f496c>0</h3> <h6 data-v-949f496c>Article</h6></div> <div data-v-949f496c><h3 data-v-949f496c>0</h3> <h6 data-v-949f496c>Tag</h6></div></div> <hr data-v-949f496c></div> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      基础
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/HTML/" class="nav-link"><i class="iconfont undefined"></i>
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/CSS/" class="nav-link"><i class="iconfont undefined"></i>
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/" class="nav-link"><i class="iconfont undefined"></i>
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/TypeScript/" class="nav-link"><i class="iconfont undefined"></i>
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      通识
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/算法/" class="nav-link"><i class="iconfont undefined"></i>
  算法
</a></li><li class="dropdown-item"><!----> <a href="/网络/" class="nav-link"><i class="iconfont undefined"></i>
  网络
</a></li><li class="dropdown-item"><!----> <a href="/浏览器/" class="nav-link"><i class="iconfont undefined"></i>
  浏览器
</a></li><li class="dropdown-item"><!----> <a href="/操作系统/" class="nav-link"><i class="iconfont undefined"></i>
  操作系统
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      框架
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Vue/" class="nav-link"><i class="iconfont undefined"></i>
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/React/" class="nav-link"><i class="iconfont undefined"></i>
  React
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      高级
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NodeJS/" class="nav-link"><i class="iconfont undefined"></i>
  NodeJS
</a></li><li class="dropdown-item"><!----> <a href="/数据库/" class="nav-link"><i class="iconfont undefined"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/优化/" class="nav-link"><i class="iconfont undefined"></i>
  优化
</a></li><li class="dropdown-item"><!----> <a href="/安全/" class="nav-link"><i class="iconfont undefined"></i>
  安全
</a></li><li class="dropdown-item"><!----> <a href="/图形/" class="nav-link"><i class="iconfont undefined"></i>
  图形
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      工具
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/webpack/" class="nav-link"><i class="iconfont undefined"></i>
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/git/" class="nav-link"><i class="iconfont undefined"></i>
  git
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      项目
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mimall/" class="nav-link"><i class="iconfont undefined"></i>
  vue-mimall
</a></li><li class="dropdown-item"><!----> <a href="/weibo/" class="nav-link"><i class="iconfont undefined"></i>
  koa2-weibo
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/JeffreyZhang96" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#内核" class="sidebar-link">内核</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#浏览器内核的理解" class="sidebar-link">浏览器内核的理解</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#浏览器内核种类" class="sidebar-link">浏览器内核种类</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#常见浏览器" class="sidebar-link">常见浏览器</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#主流浏览器内核私有属性-css-前缀" class="sidebar-link">主流浏览器内核私有属性 css 前缀</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#浏览器线程" class="sidebar-link">浏览器线程</a></li></ul></li><li><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#从输入-url-到页面加载完成的过程" class="sidebar-link">从输入 URL 到页面加载完成的过程</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#event-loop" class="sidebar-link">Event Loop</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#渲染机制" class="sidebar-link">渲染机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#load-和-domcontentloaded" class="sidebar-link">Load 和 DOMContentLoaded</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#图层" class="sidebar-link">图层</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#渲染页面时常见不良现象" class="sidebar-link">渲染页面时常见不良现象</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#settimeout-与-requestanimationframe" class="sidebar-link">setTimeout 与 requestAnimationFrame</a></li></ul></li><li><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#垃圾回收机制" class="sidebar-link">垃圾回收机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#内存泄漏" class="sidebar-link">内存泄漏</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#javascript-中的垃圾回收机制" class="sidebar-link">Javascript 中的垃圾回收机制</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#js-垃圾回收机制的原理" class="sidebar-link">JS 垃圾回收机制的原理</a></li></ul></li><li><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#错误监控" class="sidebar-link">错误监控</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#即时运行错误" class="sidebar-link">即时运行错误</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#资源加载错误" class="sidebar-link">资源加载错误</a></li></ul></li><li><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#cookie" class="sidebar-link">cookie</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#cookie-作用" class="sidebar-link">cookie 作用</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#cookie-设置" class="sidebar-link">cookie 设置</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#cookie-属性" class="sidebar-link">cookie 属性</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#cookie-缺点" class="sidebar-link">cookie 缺点</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#实现登录状态保持的两种方法-cookie、session-和-token" class="sidebar-link">实现登录状态保持的两种方法 cookie、session 和 token</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#document-cookie" class="sidebar-link">document.cookie</a></li></ul></li><li><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#sessionstorage-localstorage" class="sidebar-link">SessionStorage LocalStorage</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#缓存" class="sidebar-link">缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#etag" class="sidebar-link">ETag</a></li></ul></li><li><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#跨域" class="sidebar-link">跨域</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#同源策略限制范围" class="sidebar-link">同源策略限制范围</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#jsonp" class="sidebar-link">JSONP</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#cors" class="sidebar-link">CORS</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#proxy-接口代理" class="sidebar-link">proxy 接口代理</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#location-hash" class="sidebar-link">location.hash</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#postmessage" class="sidebar-link">postMessage</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#websocket-跨域通信" class="sidebar-link">WebSocket 跨域通信</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#document-domain" class="sidebar-link">document.domain</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#window-name" class="sidebar-link">window.name</a></li></ul></li><li><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#seo" class="sidebar-link">SEO</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#seo-2" class="sidebar-link">SEO</a></li></ul></li><li><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#模块化" class="sidebar-link">模块化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#组件化与模块化的区别" class="sidebar-link">组件化与模块化的区别</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#commonjs：" class="sidebar-link">CommonJS：</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#amd" class="sidebar-link">AMD</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#cmd" class="sidebar-link">CMD</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#es6-module" class="sidebar-link">ES6 Module</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#amd-和-cmd-区别" class="sidebar-link">AMD 和 CMD 区别</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#commonjs-和-es6-module-的区别" class="sidebar-link">CommonJS 和 ES6 Module 的区别</a></li></ul></li><li><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#websocket" class="sidebar-link">webSocket</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#实现浏览器内多个标签页之间的通信" class="sidebar-link">实现浏览器内多个标签页之间的通信</a></li></ul></li><li><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#场景" class="sidebar-link">场景</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#页面上实现一个圆形的可点击区域" class="sidebar-link">页面上实现一个圆形的可点击区域</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#一个列表，假设有-100000-个数据" class="sidebar-link">一个列表，假设有 100000 个数据</a></li><li class="sidebar-sub-header"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/#渲染几万条数据并不卡住界面" class="sidebar-link">渲染几万条数据并不卡住界面</a></li></ul></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-5d8855ac data-v-418054de><h3 class="title" style="display:none;" data-v-5d8855ac data-v-5d8855ac></h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-5d8855ac data-v-5d8855ac><input type="password" value="" data-v-5d8855ac> <span data-v-5d8855ac>Konck! Knock!</span> <button data-v-5d8855ac>OK</button></label> <div class="footer" style="display:none;" data-v-5d8855ac data-v-5d8855ac><span data-v-5d8855ac><i class="iconfont reco-theme" data-v-5d8855ac></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-5d8855ac>vuePress-theme-reco</a></span> <span data-v-5d8855ac><i class="iconfont reco-copyright" data-v-5d8855ac></i> <a data-v-5d8855ac><!---->
            
          <!---->
          2020
        </a></span></div></div> <div data-v-418054de><main class="page"><div class="page-title" style="display:none;"><h1></h1> <hr> <div data-v-0608c411><!----> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default" style="display:none;"><p>浏览器的主要功能是将用户选择的 web 资源呈现出来，它需要从服务器请求资源，并将其显示在浏览器窗口中，资源的格式通常
是 HTML，也包括 PDF、image 及其他格式。用户用 URI（Uniform Resource Identifier 统一资源标识符）来指定所请
求资源的位置。</p> <p>HTML 和 CSS 规范中规定了浏览器解释 html 文档的方式，由 W3C 组织对这些规范进行维护，W3C 是负责制定 web 标准的
组织。</p> <p>但是浏览器厂商纷纷开发自己的扩展，对规范的遵循并不完善，这为 web 开发者带来了严重的兼容性问题。</p> <p>简单来说浏览器可以分为两部分，shell 和 内核。</p> <p>其中 shell 的种类相对比较多，内核则比较少。shell 是指浏览器的外壳：例如菜单，工具栏等。主要是提供给用户界面操作，
参数设置等等。它是调用内核来实现各种功能的。内核才是浏览器的核心。内核是基于标记语言显示内容的程序或模块。也有一些
浏览器并不区分外壳和内核。从 Mozilla 将 Gecko 独立出来后，才有了外壳和内核的明确划分。</p> <h2 id="内核"><a href="#内核" class="header-anchor">#</a> <strong>内核</strong></h2> <h3 id="浏览器内核的理解"><a href="#浏览器内核的理解" class="header-anchor">#</a> 浏览器内核的理解</h3> <p>主要分成两部分：</p> <ol><li><p>渲染引擎：负责渲染，即在浏览器窗口中显示所请求的内容。默认情况下，渲染引擎可以显示 html、xml 文档及图片，它也
可以借助插件（一种浏览器扩展）显示其他类型数据，例如使用 PDF 阅读器插件，可以显示 PDF 格式。</p></li> <li><p>JS 引擎：解析和执行 javascript 来实现网页的动态效果</p></li></ol> <p>最开始渲染引擎和 JS 引擎并没有区分的很明确，后来 JS 引擎越来越独立，内核就倾向于只指渲染引擎。</p> <h3 id="浏览器内核种类"><a href="#浏览器内核种类" class="header-anchor">#</a> 浏览器内核种类</h3> <p>Trident：这种浏览器内核是 IE 浏览器用的内核，因为在早期 IE 占有大量的市场份额，所以这种内核比较流行，以前有很多
网页也是根据这个内核的标准来编写的，但是实际上这个内核对真正的网页标准支持不是很好。但是由于 IE 的高市场占有率，微
软也很长时间没有更新 Trident 内核，就导致了 Trident 内核和 W3C 标准脱节。还有就是 Trident 内核的大量 Bug 等
安全问题没有得到解决，加上一些专家学者公开自己认为 IE 浏览器不安全的观点，使很多用户开始转向其他浏览器。</p> <p>Gecko：这是 Firefox 和 Flock 所采用的内核，这个内核的优点就是功能强大、丰富，可以支持很多复杂网页效果和浏览器扩
展接口，但是代价是也显而易见就是要消耗很多的资源，比如内存。</p> <p>Presto：Opera 曾经采用的就是 Presto 内核，Presto 内核被称为公认的浏览网页速度最快的内核，这得益于它在开发时的
天生优势，在处理 JS 脚本等脚本语言时，会比其他的内核快 3 倍左右，缺点就是为了达到很快的速度而丢掉了一部分网页兼容性。</p> <p>Webkit：Webkit 是 Safari 采用的内核，它的优点就是网页浏览速度较快，虽然不及 Presto 但是也胜于 Gecko 和 Trid
ent，缺点是对于网页代码的容错性不高，也就是说对网页代码的兼容性较低，会使一些编写不标准的网页无法正确显示。WebKit
前身是 KDE 小组的 KHTML 引擎，可以说 WebKit 是 KHTML 的一个开源的分支。</p> <p>Blink：谷歌在 Chromium Blog 上发表博客，称将与苹果的开源浏览器核心 Webkit 分道扬镳，在 Chromium 项目中研发 B
link 渲染引擎（即浏览器核心），内置于 Chrome 浏览器之中。其实 Blink 引擎就是 Webkit 的一个分支，就像 webkit 是
KHTML 的分支一样。Blink 引擎现在是谷歌公司与 Opera Software 共同研发，上面提到过的，Opera 弃用了自己的 Presto
内核，加入 Google 阵营，跟随谷歌一起研发 Blink。</p> <h3 id="常见浏览器"><a href="#常见浏览器" class="header-anchor">#</a> 常见浏览器</h3> <div class="language- extra-class"><pre><code>（1） IE 浏览器内核：Trident 内核，也是俗称的 IE 内核；

（2） Chrome 浏览器内核：统称为 Chromium 内核或 Chrome 内核，以前是 Webkit 内核，现在是 Blink内核；

（3） Firefox 浏览器内核：Gecko 内核，俗称 Firefox 内核；

（4） Safari 浏览器内核：Webkit 内核；

（5） Opera 浏览器内核：最初是自己的 Presto 内核，后来加入谷歌大军，从 Webkit 又到了 Blink 内核；

（6） 360浏览器、猎豹浏览器内核：IE + Chrome 双内核；

（7） 搜狗、遨游、QQ 浏览器内核：Trident（兼容模式）+ Webkit（高速模式）；

（8） 百度浏览器、世界之窗内核：IE 内核；

（9） 2345浏览器内核：好像以前是 IE 内核，现在也是 IE + Chrome 双内核了；

（10）UC 浏览器内核：这个众口不一，UC 说是他们自己研发的 U3 内核，但好像还是基于 Webkit 和 Trident ，还有说
     是基于火狐内核。
</code></pre></div><h3 id="主流浏览器内核私有属性-css-前缀"><a href="#主流浏览器内核私有属性-css-前缀" class="header-anchor">#</a> 主流浏览器内核私有属性 css 前缀</h3> <p>mozilla 内核 （irefox,flock 等） -moz
webkit 内核 （safari,chrome 等） -webkit
opera 内核 （opera 浏览器） -o
trident 内核 （ie 浏览器） -ms</p> <h3 id="浏览器线程"><a href="#浏览器线程" class="header-anchor">#</a> 浏览器线程</h3> <p>浏览器内核是多线程，在内核控制下各线程相互配合以保持同步，一个浏览器通常由以下常驻线程组成：</p> <ul><li>GUI 渲染线程</li> <li>JavaScript 引擎线程</li> <li>定时触发器线程</li> <li>事件触发线程</li> <li>异步 http 请求线程</li></ul> <h4 id="_1-gui-渲染线程"><a href="#_1-gui-渲染线程" class="header-anchor">#</a> 1.GUI 渲染线程</h4> <ul><li>主要负责页面的渲染，解析 HTML、CSS，构建 DOM 树，布局和绘制等。</li> <li>当界面需要重绘或者由于某种操作引发回流时，将执行该线程。</li> <li>该线程与 JS 引擎线程互斥，当执行 JS 引擎线程时，GUI 渲染会被挂起，当任务队列空闲时，主线程才会去执行 GUI 渲染。</li></ul> <h4 id="_2-js-引擎线程"><a href="#_2-js-引擎线程" class="header-anchor">#</a> 2.JS 引擎线程</h4> <ul><li>该线程当然是主要负责处理 JavaScript 脚本，执行代码。</li> <li>也是主要负责执行准备好待执行的事件，即定时器计数结束，或者异步请求成功并正确返回时，将依次进入任务队列，等待 JS 引擎线程的执行。</li> <li>当然，该线程与 GUI 渲染线程互斥，当 JS 引擎线程执行 JavaScript 脚本时间过长，将导致页面渲染的阻塞。</li></ul> <h4 id="_3-定时器触发线程"><a href="#_3-定时器触发线程" class="header-anchor">#</a> 3.定时器触发线程</h4> <ul><li>负责执行异步定时器一类的函数的线程，如： setTimeout，setInterval。</li> <li>主线程依次执行代码时，遇到定时器，会将定时器交给该线程处理，当计数完毕后，事件触发线程会将计数完毕后的事件加入到任务队列的尾部，等待 JS 引擎线程执行。</li></ul> <h4 id="_4-事件触发线程"><a href="#_4-事件触发线程" class="header-anchor">#</a> 4.事件触发线程</h4> <ul><li>主要负责将准备好的事件交给 JS 引擎线程执行。</li></ul> <p>比如 setTimeout 定时器计数结束， ajax 等异步请求成功并触发回调函数，或者用户触发点击事件时，该线程会将整装待发的事件依次加入到任务队列的队尾，等待 JS 引擎线程的执行。</p> <h4 id="_5-异步-http-请求线程"><a href="#_5-异步-http-请求线程" class="header-anchor">#</a> 5.异步 http 请求线程</h4> <ul><li>负责执行异步请求一类的函数的线程，如： Promise，axios，ajax 等。</li> <li>主线程依次执行代码时，遇到异步请求，会将函数交给该线程处理，当监听到状态码变更，如果有回调函数，事件触发线程会将回调函数加入到任务队列的尾部，等待 JS 引擎线程执行。</li></ul> <h2 id="从输入-url-到页面加载完成的过程"><a href="#从输入-url-到页面加载完成的过程" class="header-anchor">#</a> <strong>从输入 URL 到页面加载完成的过程</strong></h2> <ol><li><p>在浏览器地址栏输入 URL</p></li> <li><p>浏览器查看缓存，如果请求资源在缓存中并且没过期，跳转到转码步骤</p> <ol><li>如果资源未缓存，发起新请求</li> <li>如果已缓存，检验是否过期，没过期直接提供给客户端，否则与服务器进行验证。</li> <li>检验新鲜通常有两个 HTTP 头进行控制 Expires 和 Cache-Control：
<ul><li>HTTP1.0 提供 Expires，值为一个绝对时间表示缓存新鲜日期</li> <li>HTTP1.1 增加了 Cache-Control: max-age=,值为以秒为单位的最大过期时间</li></ul></li></ol></li> <li><p>浏览器解析 URL 获取协议，主机，端口，路径</p></li> <li><p>浏览器组装一个 HTTP（GET）请求报文</p></li> <li><p>浏览器获取主机 ip 地址，过程如下：</p> <ol><li>浏览器缓存</li> <li>本机缓存</li> <li>hosts 文件</li> <li>路由器缓存</li> <li>ISP DNS 缓存</li> <li>DNS 递归查询（可能存在负载均衡导致每次 IP 不一样）</li></ol></li> <li><p>打开一个 socket 与目标 IP 地址，端口建立 TCP 链接，三次握手如下：</p> <ol><li>客户端发送一个 TCP 的 SYN=1，seq=X 的包到服务器端口</li> <li>服务器发回 SYN=1， ACK=X+1， seq=Y 的响应包</li> <li>客户端发送 ACK=Y+1， seq=Z</li></ol></li> <li><p>TCP 链接建立后发送 HTTP 请求</p></li> <li><p>服务器接受请求并解析，将请求转发到服务程序，如虚拟主机使用 HTTP Host 头部判断请求的服务程序</p></li> <li><p>服务器检查 HTTP 请求头是否包含缓存验证信息如果验证缓存未更新，返回 304 等对应状态码</p></li> <li><p>处理程序读取完整请求并准备 HTTP 响应，可能需要查询数据库等操作</p></li> <li><p>服务器将响应报文通过 TCP 连接发送回浏览器</p></li> <li><p>浏览器接收 HTTP 响应，然后根据情况选择关闭 TCP 连接或者保留重用，关闭 TCP 连接的四次握手如下：</p> <ol><li>主动方发送 Fin=1， Ack=Z， Seq= X 报文</li> <li>被动方发送 ACK=X+1， Seq=Z 报文</li> <li>被动方发送 Fin=1， ACK=X， Seq=Y 报文</li> <li>主动方发送 ACK=Y， Seq=X 报文</li></ol></li> <li><p>浏览器检查响应状态吗：是否为 1XX，3XX， 4XX， 5XX，这些情况处理与 2XX 不同</p></li> <li><p>如果资源可缓存，进行缓存</p></li> <li><p>对响应进行解码（例如 gzip 压缩）</p></li> <li><p>根据资源类型决定如何处理（假设资源为 HTML 文档）</p></li> <li><p>解析 HTML 文档，构建 DOM 树，下载资源，构造 CSSOM 树，执行 js 脚本</p></li> <li><p>构建 DOM 树：</p> <ol><li>Tokenizing：根据 HTML 规范将字符流解析为标记</li> <li>Lexing：词法分析将标记转换为对象并定义属性和规则</li> <li>DOM construction：根据 HTML 标记关系将对象组成 DOM 树</li></ol></li> <li><p>解析过程中遇到图片、样式表、js 文件，启动下载</p></li> <li><p>构建 CSSOM 树：</p> <ol><li>Tokenizing：字符流转换为标记流</li> <li>Node：根据标记创建节点</li> <li>CSSOM：节点创建 CSSOM 树</li></ol></li> <li><p>根据 DOM 树和 CSSOM 树构建渲染树:</p> <ol><li>从 DOM 树的根节点遍历所有可见节点，不可见节点包括：</li></ol> <ul><li>script,meta 这样本身不可见的标签。</li> <li>被 css 隐藏的节点，如 display: none</li></ul> <ol start="2"><li>对每一个可见节点，找到恰当的 CSSOM 规则并应用</li> <li>发布可视节点的内容和计算样式</li></ol></li> <li><p>js 解析如下：</p> <ol><li>浏览器创建 Document 对象并解析 HTML，将解析到的元素和文本节点添加到文档中，此时 document.readystate 为 loading</li> <li>HTML 解析器遇到没有 async 和 defer 的 script 时，将他们添加到文档中，然后执行行内或外部脚本。这些脚本会同步执行，并且在脚本下载和执行时解析器会暂停。这样就可以用 document.write()把文本插入到输入流中。同步脚本经常简单定义函数和注册事件处理程序，他们可以遍历和操作 script 和他们之前的文档内容</li> <li>当解析器遇到设置了 async 属性的 script 时，开始下载脚本并继续解析文档。脚本会在它下载完成后尽快执行，但是解析器不会停下来等它下载。异步脚本禁止使用 document.write()，它们可以访问自己 script 和之前的文档元素</li> <li>当文档完成解析，document.readState 变成 interactive</li> <li>所有 defer 脚本会按照在文档出现的顺序执行，延迟脚本能访问完整文档树，禁止使用 document.write()</li> <li>浏览器在 Document 对象上触发 DOMContentLoaded 事件</li> <li>此时文档完全解析完成，浏览器可能还在等待如图片等内容加载，等这些内容完成载入并且所有异步脚本完成载入和执行，document.readState 变为 complete，window 触发 load 事件</li></ol></li> <li><p>显示页面（HTML 解析过程中会逐步显示页面）</p></li></ol> <h2 id="event-loop"><a href="#event-loop" class="header-anchor">#</a> <strong>Event Loop</strong></h2> <p><a href="https://blog.csdn.net/searchin_r/article/details/82935866" target="_blank" rel="noopener noreferrer">JavaScript——从 setTimeout()的执行了解 js 的单线程和异步<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://zhuanlan.zhihu.com/p/41543963" target="_blank" rel="noopener noreferrer">Event Loop 这个循环你晓得么？(附 GIF 详解)-饿了么前端<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>因为 js 是单线程运行的，在代码执行的时候，通过将不同函数的执行上下文压入执行栈中来保证代码的有序执行。在执行同步代码
的时候，如果遇到了异步事件，js 引擎并不会一直等待其返回结果，而是会将这个事件挂起，继续执行执行栈中的其他任务。当异步
事件执行完毕后，再将异步事件对应的回调加入到与当前执行栈中不同的另一个任务队列中等待执行。任务队列可以分为宏任务对列和
微任务对列，当当前执行栈中的事件执行完毕后，js 引擎首先会判断微任务对列中是否有任务可以执行，如果有就将微任务队首的事
件压入栈中执行。当微任务对列中的任务都执行完成后再去判断宏任务对列中的任务。</p> <p>微任务包括了 promise 的回调、node 中的 process.nextTick 、对 Dom 变化监听的 MutationObserver。</p> <p>宏任务包括了 script 脚本的执行、setTimeout ，setInterval ，setImmediate 一类的定时事件，还有如 I/O 操作、UI 渲
染等。</p> <h4 id="micro-task-与-macro-task"><a href="#micro-task-与-macro-task" class="header-anchor">#</a> Micro-Task 与 Macro-Task</h4> <p>浏览器端事件循环中的异步队列有两种：macro（宏任务）队列和 micro（微任务）队列。<strong>宏任务队列可以有多个，微任务队列只有一个</strong>。</p> <ul><li>常见的 macro-task 比如：setTimeout、setInterval、script（整体代码）、 I/O 操作、UI 渲染等。</li> <li>常见的 micro-task 比如: new Promise().then(回调)、MutationObserver(html5 新特性) 等。</li></ul> <h4 id="event-loop-过程解析"><a href="#event-loop-过程解析" class="header-anchor">#</a> Event Loop 过程解析</h4> <p>一个完整的 Event Loop 过程，可以概括为以下阶段：</p> <p><img src="https://camo.githubusercontent.com/875c5b741e008b6cfbf92958bce1819f6cb51770/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031392f312f31302f313638333836333633333538363937343f773d33393426683d34343926663d706e6726733d3838343433" alt=""></p> <ul><li><p>一开始执行栈空,我们可以把<strong>执行栈认为是一个存储函数调用的栈结构，遵循先进后出的原则</strong>。micro 队列空，macro 队列里有且只有一个 script 脚本（整体代码）。</p></li> <li><p>全局上下文（script 标签）被推入执行栈，同步代码执行。在执行的过程中，会判断是同步任务还是异步任务，通过对一些接口的调用，可以产生新的 macro-task 与 micro-task，它们会分别被推入各自的任务队列里。同步代码执行完了，script 脚本会被移出 macro 队列，这个过程本质上是队列的 macro-task 的执行和出队的过程。</p></li> <li><p>上一步我们出队的是一个 macro-task，这一步我们处理的是 micro-task。但需要注意的是：当 macro-task 出队时，任务是<strong>一个一个</strong>执行的；而 micro-task 出队时，任务是<strong>一队一队</strong>执行的。因此，我们处理 micro 队列这一步，会逐个执行队列中的任务并把它出队，直到队列被清空。</p></li> <li><p><strong>执行渲染操作，更新界面</strong></p></li> <li><p>检查是否存在 Web worker 任务，如果有，则对其进行处理</p></li> <li><p>上述过程循环往复，直到两个队列都清空</p></li></ul> <p>我们总结一下，每一次循环都是一个这样的过程：</p> <p><img src="https://camo.githubusercontent.com/877fe5d0b39d2696b12844b04f3d134cc9f957b1/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031392f312f31302f313638333837376261396161623035363f773d36323826683d31333226663d706e6726733d3530303238" alt=""></p> <p>当某个宏任务执行完后,会查看是否有微任务队列。如果有，先执行微任务队列中的所有任务，如果没有，会读取宏任务队列中排在最前的任务，执行宏任务的过程中，遇到微任务，依次加入微任务队列。栈空后，再次读取微任务队列里的任务，依次类推</p> <p>接下来我们看道例子来介绍上面流程：</p> <div class="language-js extra-class"><pre class="language-js"><code>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Promise1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;setTimeout2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;setTimeout1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Promise2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>最后输出结果是 Promise1，setTimeout1，Promise2，setTimeout2</p> <ul><li>一开始执行栈的同步任务（这属于宏任务）执行完毕，会去查看是否有微任务队列，上题中存在(有且只有一个)，然后执行微任务队列中的所有任务输出 Promise1，同时会生成一个宏任务 setTimeout2</li> <li>然后去查看宏任务队列，宏任务 setTimeout1 在 setTimeout2 之前，先执行宏任务 setTimeout1，输出 setTimeout1</li> <li>在执行宏任务 setTimeout1 时会生成微任务 Promise2 ，放入微任务队列中，接着先去清空微任务队列中的所有任务，输出 Promise2</li> <li>清空完微任务队列中的所有任务后，就又会去宏任务队列取一个，这回执行的是 setTimeout2</li></ul> <h2 id="渲染机制"><a href="#渲染机制" class="header-anchor">#</a> <strong>渲染机制</strong></h2> <p>浏览器的渲染机制一般分为以下几个步骤</p> <ol><li>处理 HTML 并构建 DOM 树<a href="https://segmentfault.com/a/1190000018730884" target="_blank" rel="noopener noreferrer">浏览器将标签转成 DOM 的过程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>处理 CSS 构建 CSSOM 树</li> <li>将 DOM 与 CSSOM 合并成一个渲染树</li> <li>根据渲染树来布局，计算每个节点的位置</li> <li>调用 GPU 绘制，合成图层，显示在屏幕上</li></ol> <p><img src="https://yck-1254263422.cos.ap-shanghai.myqcloud.com/blog/2019-06-01-042733.png" alt=""></p> <p>在构建 CSSOM 树时，会阻塞渲染，直至 CSSOM 树构建完成。并且构建 CSSOM 树是一个十分消耗性能的过程，所以应该尽量保证层级扁平，减少过度层叠，越是具体的 CSS 选择器，执行速度越慢。</p> <p>JavaScript 的加载、解析与执行会阻塞文档的解析，也就是说，在构建 DOM 时，HTML 解析器若遇到了 JavaScript，那么它会暂停文档的解析，将控制权移交给 JavaScript 引擎，等 JavaScript 引擎运行完毕，浏览器再从中断的地方恢复继续解析文档。也就是说，如果你想首屏渲染的越快，就越不应该在首屏就加载 JS 文件，这也是都建议将 script 标签放在 body 标签底部的原因。当然在当下，并不是说 script 标签必须放在底部，因为你可以给 script 标签添加 defer 或者 async 属性。</p> <p><img src="https://yck-1254263422.cos.ap-shanghai.myqcloud.com/blog/2019-06-01-042734.png" alt=""></p> <p><img src="https://yck-1254263422.cos.ap-shanghai.myqcloud.com/blog/2019-06-01-042735.png" alt=""></p> <h3 id="load-和-domcontentloaded"><a href="#load-和-domcontentloaded" class="header-anchor">#</a> Load 和 DOMContentLoaded</h3> <p>当初始的 HTML 文档被完全加载和解析完成之后，DOMContentLoaded 事件被触发，而无需等待样式表、图像和
子框架的加载完成。</p> <p>Load 事件是当所有资源加载完成后触发的。</p> <h3 id="图层"><a href="#图层" class="header-anchor">#</a> 图层</h3> <p>一般来说，可以把普通文档流看成一个图层。特定的属性可以生成一个新的图层。<strong>不同的图层渲染互不影响</strong>，所以对于某些频繁需要渲染的建议单独生成一个新图层，提高性能。<strong>但也不能生成过多的图层，会引起反作用。</strong></p> <p>通过以下几个常用属性可以生成新图层</p> <ul><li>3D 变换：<code>translate3d</code>、<code>translateZ</code></li> <li><code>will-change</code></li> <li><code>video</code>、<code>iframe</code> 标签</li> <li>通过动画实现的 <code>opacity</code> 动画转换</li> <li><code>position: fixed</code></li></ul> <h3 id="渲染页面时常见不良现象"><a href="#渲染页面时常见不良现象" class="header-anchor">#</a> 渲染页面时常见不良现象</h3> <div class="language- extra-class"><pre><code>FOUC：主要指的是样式闪烁的问题，由于浏览器渲染机制（比如firefox），在 CSS 加载之前，先呈现了 HTML，就会导致展示
      出无样式内容，然后样式突然呈现的现象。会出现这个问题的原因主要是 css 加载时间过长，或者 css 被放在了文档底
      部。

白屏：有些浏览器渲染机制（比如chrome）要先构建 DOM 树和 CSSOM 树，构建完成后再进行渲染，如果 CSS 部分放在 HTML
     尾部，由于 CSS 未加载完成，浏览器迟迟未渲染，从而导致白屏；也可能是把 js 文件放在头部，脚本的加载会阻塞后面
     文档内容的解析，从而页面迟迟未渲染出来，出现白屏问题。
</code></pre></div><h3 id="settimeout-与-requestanimationframe"><a href="#settimeout-与-requestanimationframe" class="header-anchor">#</a> setTimeout 与 requestAnimationFrame</h3> <ul><li>引擎层面：</li></ul> <p>setTimeout 属于 JS 引擎，存在事件轮询，任务队列中的任务只有在主线程任务执行完毕后才会被执行。会在指定的时间 n 毫秒后，将指定的回调函数 fn 放进任务队列中，因此并不是 n 秒后就会执行回调函数。</p> <p>requestAnimationFrame 属于 GUI 引擎</p> <ul><li>性能层面：</li></ul> <p>当页面被隐藏或最小化时，定时器 setTimeout 仍在后台执行动画任务。</p> <p>当页面处于未激活的状态下，该页面的屏幕刷新任务会被系统暂停，requestAnimationFrame 也会停止。</p> <ul><li>应用层面：</li></ul> <p>利用 setTimeout，这种定时机制去做动画，模拟固定时间刷新页面。</p> <p>requestAnimationFrame 由浏览器专门为动画提供的 API，在运行时浏览器会自动优化方法的调用，在特定性环境下可以有效节省了 CPU 开销。一般显示器刷新频率为 60HZ，即 16.6ms 刷新一次屏幕。setTimeout 可能会掉帧。</p> <h2 id="垃圾回收机制"><a href="#垃圾回收机制" class="header-anchor">#</a> <strong>垃圾回收机制</strong></h2> <h3 id="内存泄漏"><a href="#内存泄漏" class="header-anchor">#</a> 内存泄漏</h3> <p>内存泄漏指任何对象在您不再拥有或需要它之后仍然存在。</p> <p>垃圾回收器定期扫描对象，并计算引用了每个对象的其他对象的数量。如果一个对象的引用数量为 0（没有其他对象引用过该对象），或对该对象的惟一引用是循环的，那么该对象的内存即可回收。</p> <ol><li><p>setTimeout 的第一个参数使用字符串而非函数的话，会引发内存泄漏。</p></li> <li><p>闭包可能会导致内存泄漏</p></li> <li><p>控制台日志</p></li> <li><p>循环（在两个对象彼此引用且彼此保留时，就会产生一个循环）</p></li> <li><p>删除 DOM 时，还存在 DOM 的引用，比如，我们给 DOM 绑定点击事件，之后删除 DOM 节点。因为还存在引用，所以内存没有被释放。</p></li></ol> <p>比如，我们给 DOM 绑定点击事件，之后删除 DOM 节点。因为还存在引用，所以内存没有被释放。</p> <ol start="6"><li>意外的全局变量</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 意外的声明了全局的变量，在页面关闭前a变量都不会被回收</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  a <span class="token operator">=</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a href="https://segmentfault.com/a/1190000020231307" target="_blank" rel="noopener noreferrer">深入了解 JavaScript 内存泄露<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="javascript-中的垃圾回收机制"><a href="#javascript-中的垃圾回收机制" class="header-anchor">#</a> Javascript 中的垃圾回收机制</h3> <p>在 Javascript 中，如果一个对象不再被引用，那么这个对象就会被<strong>GC</strong>回收。如果两个对象互相引用，而不再被第 3 者所引用，那么这两个互相引用的对象也会被回收。因为函数 a 被 b 引用，b 又被 a 外的 c 引用，这就是为什么 函数 a 执行后不会被回收的原因。</p> <h3 id="js-垃圾回收机制的原理"><a href="#js-垃圾回收机制的原理" class="header-anchor">#</a> JS 垃圾回收机制的原理</h3> <p>内存泄漏：不再用到的内存，没有及时释放，就叫做内存泄漏。解决内存的泄露，垃圾回收机制会定期找出那些不再用到的内存（变量），然后释放其内存。</p> <p>现在各大浏览器通常采用的垃圾回收机制有两种方法：标记清除，引用计数。</p> <ol><li><p>标记清除：js 中最常用的垃圾回收方式就是标记清除。当变量进入环境时，例如，在一个函数中声明一个变量，就将这个变量标记为&quot;进入环境&quot;，从逻辑上讲，永远不能释放进入环境变量所占用的内存，因为只要执行流进入相应的环境，就可能会用到它们。而当变量离开环境时，则将其标记为&quot;离开环境&quot;。</p> <div class="language- extra-class"><pre class="language-text"><code>function test(){
var a = 10; *//*被标记*&quot;*进入环境*&quot;*
var b = &quot;hello&quot;; *//*被标记*&quot;*进入环境*&quot;*
test(); *//*执行完毕后之后，*a*和*b*又被标记*&quot;*离开环境*&quot;*，被回收
</code></pre></div></li> <li><p>引用计数：语言引擎有一张&quot;引用表&quot;，保存了内存里面所有资源（通常是各种值）的引用次数。如果一个值的引用次数是 0，就表示这个值不再用到了，因此可以将这块内存释放。如果一个值不再需要了，引用数却不为 0，垃圾回收机制无法释放这块内存，从而导致内存泄漏。</p> <div class="language- extra-class"><pre class="language-text"><code>const arr = [1,2,3,4];
console.log(&quot;hello world&quot;)
</code></pre></div></li></ol> <p>上面的代码中，数组[1,2,3,4]是一个值，会占用内存。变量 arr 是仅有的对这个值的引用，因此引用次数为 1。尽管后面的代码没有用到 arr，它是会持续占用内存。</p> <p>如果增加一行代码，解除 arr 对[1,2,3,4]引用，这块内存就可以被垃圾回收机制释放了。</p> <div class="language- extra-class"><pre class="language-text"><code>let arr = [1,2,3,4];

console.log(&quot;hello world&quot;);

arr = null;
</code></pre></div><p>上面代码中，arr 重置为 null，就解除了对[1，2，3，4]的引用，引用次数变成了 0，内存就可以释放出来了。</p> <p>因此，并不是说有了垃圾回收机制，程序员就轻松了。你还是需要关注内存占用：那些很占空间的值，一旦不再用到，你必须检查是否还存在对它们的引用。如果是的话，就必须手动解除引用</p> <h2 id="错误监控"><a href="#错误监控" class="header-anchor">#</a> <strong>错误监控</strong></h2> <h3 id="即时运行错误"><a href="#即时运行错误" class="header-anchor">#</a> 即时运行错误</h3> <p>代码错误</p> <ol><li>try...catch</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> b <span class="token operator">=</span> a <span class="token operator">+</span> c<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//捕获处理</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ReferenceError:c is not defined</span>
<span class="token punctuation">}</span>
</code></pre></div><p>不过对于异步代码，使用 try...catch 是无法捕捉其内部发生的错误，比如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;222&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//未能捕获到异常，不输出2</span>
</code></pre></div><p>可以通过 async/await 和 promise 来解决此问题，当 await 后面的 promise 状态为 reject 时，会抛出错误。所以我们可以搭配 async/await 和 promisse 来进行异步的错误捕捉。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;222&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>window.onerror</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">errorMessage<span class="token punctuation">,</span> scriptURI<span class="token punctuation">,</span> lineNo<span class="token punctuation">,</span> columnNo<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;errorMessage: &quot;</span> <span class="token operator">+</span> errorMessage<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 异常信息</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;scriptURI: &quot;</span> <span class="token operator">+</span> scriptURI<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 异常文件路径</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;lineNo: &quot;</span> <span class="token operator">+</span> lineNo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 异常行号</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;columnNo: &quot;</span> <span class="token operator">+</span> columnNo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 异常列号</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;error: &quot;</span> <span class="token operator">+</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 异常堆栈信息</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="资源加载错误"><a href="#资源加载错误" class="header-anchor">#</a> 资源加载错误</h3> <p>图片、JS、CSS 加载失败</p> <ol><li>object.onerror</li></ol> <p>img 标签、script 标签都可以添加 onerror 事件，用来捕获资源加载错误</p> <ol start="2"><li>performance.getEntries</li></ol> <p>可以获取所有已加载资源的加载时间，通过这种方式，可以间接的拿到没有加载的资源错误</p> <h2 id="cookie"><a href="#cookie" class="header-anchor">#</a> <strong>cookie</strong></h2> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Cookies" target="_blank" rel="noopener noreferrer">HTTP cookies<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>HTTP 是一个无状态的协议，每次 http 请求都是独立、无关的，默认不需要保留状态信息。</p> <p>有时候需要保存一些状态，HTTP 为此引入了 Cookie。Cookie 本质上就是浏览器里面存储的一个很小的文本文件，内部以键值对的方式来存储。向同一个域名下发送请求，都会携带相同的 Cookie，服务器拿到 Cookie 进行解析，便能拿到客户端的状态。而服务端可以通过响应头中的 Set-Cookie 字段来对客户端写入 Cookie。</p> <h3 id="cookie-作用"><a href="#cookie-作用" class="header-anchor">#</a> cookie 作用</h3> <ol><li>会话状态管理（如用户登录状态、购物车、游戏分数或其它需要记录的信息）</li> <li>个性化设置（如用户自定义设置、主题等）</li> <li>浏览器行为跟踪（如跟踪分析用户行为等）</li></ol> <h3 id="cookie-设置"><a href="#cookie-设置" class="header-anchor">#</a> cookie 设置</h3> <ol><li>当服务器收到 HTTP 请求时，服务器可以在响应头里面添加一个 <code>Set-Cookie</code> 选项。</li> <li>浏览器收到响应后通常会保存下 Cookie，之后对该服务器每一次请求中都通过 <code>Cookie</code> 请求头部将 Cookie 信息发送给服务器（会带来额外的性能开销（尤其是在移动环境下）。新的浏览器 API 已经允许开发者直接将数据存储到本地，如使用 Web storage API （本地存储和会话存储）或 IndexedDB )</li></ol> <p>Cookie 的过期时间、域、路径、有效期、适用站点都可以根据需要来指定。</p> <h3 id="cookie-属性"><a href="#cookie-属性" class="header-anchor">#</a> cookie 属性</h3> <p><img src="/assets/img/cookie.jpg" alt=""></p> <h4 id="name-value"><a href="#name-value" class="header-anchor">#</a> Name/Value</h4> <p>用 JavaScript 操作 Cookie 的时候注意对 Value 进行编码处理。</p> <h4 id="expires-max-age"><a href="#expires-max-age" class="header-anchor">#</a> Expires/Max-Age</h4> <div class="language- extra-class"><pre class="language-text"><code>Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT;
Set-Cookie: id=a3fWa; Max-Age=604800;
</code></pre></div><p>会话性 Cookie:浏览器关闭之后它会被自动删除，也就是说它仅在会话期内有效。会话期 Cookie 不需要指定过期时间（Expires）或者有效期（Max-Age），会被设置为 Session</p> <p>持久性 Cookie:可以指定一个特定的过期时间（Expires）或有效期（Max-Age）</p> <ul><li><p>Max-Age 为正数，浏览器会将其持久化，即写到对应的 Cookie 文件中。</p></li> <li><p>Max-Age 为负数，则表示该 Cookie 只是一个会话性 Cookie。</p></li> <li><p>Max-Age 为 0 时，则会立即删除这个 Cookie。</p></li></ul> <h4 id="domain"><a href="#domain" class="header-anchor">#</a> Domain</h4> <p>Domain 指定了 Cookie 可以送达的主机名。假如没有指定，那么默认值为当前文档访问地址中的主机部分（但是不包含子域名）。</p> <p>像淘宝首页设置的 Domain 就是 .taobao.com，这样无论是 a.taobao.com 还是 b.taobao.com 都可以使用 Cookie。</p> <p>在这里注意的是，不能跨域设置 Cookie，比如阿里域名下的页面把 Domain 设置成百度是无效的：</p> <div class="language- extra-class"><pre class="language-text"><code>Set-Cookie: qwerty=219ffwef9w0f; Domain=baidu.com; Path=/; Expires=Wed, 30 Aug 2020 00:00:00 GMT
</code></pre></div><h4 id="path"><a href="#path" class="header-anchor">#</a> Path</h4> <p>Path 指定了一个 URL 路径，这个路径必须出现在要请求的资源的路径中才可以发送 Cookie 首部</p> <p>比如设置 Path=/docs，/docs/Web/ 下的资源会带 Cookie 首部，/test 则不会携带 Cookie 首部</p> <p>Domain 和 Path 标识共同定义了 Cookie 的作用域：即 Cookie 应该发送给哪些 URL</p> <h4 id="secure"><a href="#secure" class="header-anchor">#</a> Secure</h4> <p>标记为 Secure 的 Cookie 只应通过被 HTTPS 协议加密过的请求发送给服务端。使用 HTTPS 安全协议，可以保护 Cookie 在浏览器和 Web 服务器间的传输过程中不被窃取和篡改。</p> <h4 id="httponly"><a href="#httponly" class="header-anchor">#</a> HttpOnly</h4> <p>防止客户端 JS 通过 document.cookie 等方式访问 Cookie，有助于避免 XSS 攻击</p> <h4 id="samesite"><a href="#samesite" class="header-anchor">#</a> SameSite</h4> <p>让 Cookie 在跨站请求时不会被发送，从而可以阻止跨站请求伪造攻击（CSRF）</p> <ol><li>None</li></ol> <p>无论是否跨站都会发送 Cookie</p> <ol start="2"><li>Strict</li></ol> <p>浏览器将只发送相同站点请求的 cookie(即当前网页 URL 与请求目标 URL 完全一致)。如果请求来自与当前 location 的 URL 不同的 URL，则不包括标记为 Strict 属性的 cookie。</p> <ol start="3"><li>Lax</li></ol> <p>在新版本浏览器中，为默认选项，Same-site cookies 将会为一些跨站子请求保留，如图片加载或者 frames 的调用，但只有当用户从外部站点导航到 URL 时才会发送。如 link 链接</p> <p>之前默认是 None 的，Chrome80 后默认是 Lax</p> <p><img src="/assets/img/SameSite.png" alt=""></p> <p>对大部分 web 应用而言，Post 表单，iframe，AJAX，Image 这四种情况从以前的跨站会发送三方 Cookie，变成了不发送。</p> <p>Post 表单：应该的，学 CSRF 总会举表单的例子。</p> <p>iframe：iframe 嵌入的 web 应用有很多是跨站的，都会受到影响。</p> <p>AJAX：可能会影响部分前端取值的行为和结果。</p> <p>Image：图片一般放 CDN，大部分情况不需要 Cookie，故影响有限。但如果引用了需要鉴权的图片，可能会受到影响。</p> <p>除了这些还有 script 的方式，这种方式也不会发送 Cookie，像淘宝的大部分请求都是 jsonp，如果涉及到跨站也有可能会被影响。</p> <p>问题</p> <ol><li><p>天猫和飞猪的页面靠请求淘宝域名下的接口获取登录信息，由于 Cookie 丢失，用户无法登录，页面还会误判断成是由于用户开启了浏览器的“禁止第三方 Cookie”功能导致而给与错误的提示</p></li> <li><p>淘宝部分页面内嵌支付宝确认付款和确认收货页面、天猫内嵌淘宝的登录页面等，由于 Cookie 失效，付款、登录等操作都会失败</p></li> <li><p>阿里妈妈在各大网站比如今日头条，网易，微博等投放的广告，也是用 iframe 嵌入的，没有了 Cookie，就不能准确的进行推荐</p></li> <li><p>一些埋点系统会把用户 id 信息埋到 Cookie 中，用于日志上报，这种系统一般走的都是单独的域名，与业务域名分开，所以也会受到影响。</p></li> <li><p>一些用于防止恶意请求的系统，对判断为恶意请求的访问会弹出验证码让用户进行安全验证，通过安全验证后会在请求所在域种一个 Cookie，请求中带上这个 Cookie 之后，短时间内不再弹安全验证码。在 Chrome80 以上如果因为 Samesite 的原因请求没办法带上这个 Cookie，则会出现一直弹出验证码进行安全验证。</p></li> <li><p>天猫商家后台请求了跨域的接口，因为没有 Cookie，接口不会返回数据</p></li></ol> <p>解决</p> <p>解决方案就是设置 SameSite 为 none。</p> <ol><li><p>HTTP 接口不支持 SameSite=none
如果你想加 SameSite=none 属性，那么该 Cookie 就必须同时加上 Secure 属性，表示只有在 HTTPS 协议下该 Cookie 才会被发送。</p></li> <li><p>需要 UA 检测，部分浏览器不能加 SameSite=none
IOS 12 的 Safari 以及老版本的一些 Chrome 会把 SameSite=none 识别成 SameSite=Strict，所以服务端必须在下发 Set-Cookie 响应头时进行 User-Agent 检测，对这些浏览器不下发 SameSite=none 属性</p></li></ol> <h3 id="cookie-缺点"><a href="#cookie-缺点" class="header-anchor">#</a> cookie 缺点</h3> <ol><li><p>容量缺陷。Cookie 的体积上限只有 4KB，只能用来存储少量的信息。</p></li> <li><p>性能缺陷。Cookie 紧跟域名，不管域名下面的某一个地址需不需要这个 Cookie ，请求都会携带上完整的 Cookie，这样随着请求数的增多，其实会造成巨大的性能浪费的，因为请求携带了很多不必要的内容。但可以通过 Domain 和 Path 指定作用域来解决。</p></li> <li><p>安全缺陷。由于 Cookie 以纯文本的形式在浏览器和服务器中传递，很容易被非法用户截获，然后进行一系列的篡改，在 Cookie 的有效期内重新发送给服务器，这是相当危险的。另外，在 HttpOnly 为 false 的情况下，Cookie 信息能直接通过 JS 脚本来读取。</p></li></ol> <h3 id="实现登录状态保持的两种方法-cookie、session-和-token"><a href="#实现登录状态保持的两种方法-cookie、session-和-token" class="header-anchor">#</a> 实现登录状态保持的两种方法 cookie、session 和 token</h3> <p>实现登录状态保持的两种方法：</p> <p>第一种，cookie 和 session 的配合使用</p> <p>实现原理：当用户请求页面，一般需要先登录，用户第一次输入用户名和密码之后，前台发送 post 请求，后台获取用户信息，通过查询数据库来验证用户信息是否正确，如果验证通过，则会开辟一块 session 空间来储存用户数据，并且同时生成一个 cookie 字符串，由后台返回给前台，前台接收后，会把这个 cookie 字符串储存到浏览器的 cookie 空间中，这个 cookie 就相当于一把钥匙，可以打开后台存储对应用户信息的锁，当用户下一次请求的时候，客户端便会自动携带这个 cookie 去请求服务器，服务器识别后，就会读取 session 中的用户信息，这样用户就可以直接访问，就不需要再输入用户名密码来验证身份了。
优缺点： 优点是：提升了用户体验，cookie 和 session 的结合使用，比直接在客户端保存用户信息要相对安全；缺点是：当服务器向浏览器传送 cookie 的时候，很容易被劫持，并不是绝对的安全，还有一点就是，在大型的项目中，服务器往往不只一台，如果第一次请求，用户信息被保存在了服务器 1 的 session 空间中，但是第二次请求被分流到了服务器 2，这样就获取不到用户信息了，依然要重新登录，所以又引出了另一种方法：token 来实现。</p> <p>第二种，使用 token 安全令牌</p> <p>实现原理：当用户请求页面，输入用户信息，服务端经过验证后，会生成一个 token 安全令牌（随机字符串），并返回给客户端，当客户端发送下一次请求的时候，直接携带这个 token，服务端识别后，就可以直接访问页面，不需要再次登录了
优点：token 只是以字符串的形式存在，不要服务器再开辟空间，并且相对更安全，即使在传输的过程中被劫持，别人也并不能破解内容，并且减少了服务器压力，减少频繁的查询数据库。</p> <h3 id="document-cookie"><a href="#document-cookie" class="header-anchor">#</a> document.cookie</h3> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/cookie" target="_blank" rel="noopener noreferrer">document.cookie<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ol><li>得到 cookie</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>docCookies<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>读取一个 cookie。如果 cookie 不存在返回 null。</p> <p>name:读取的 cookie 名 (string).</p> <ol start="2"><li>移除 cookie</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>   docCookies<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span>name<span class="token punctuation">[</span><span class="token punctuation">,</span> path<span class="token punctuation">]</span><span class="token punctuation">,</span>domain<span class="token punctuation">)</span>
</code></pre></div><p>删除一个 cookie。</p> <p>name:要移除的 cookie 名(string).</p> <p>path:例如 '/', '/mydir'。 如果没有定义，默认为当前文档位置的路径。(string or null)。路径必须为绝对路径（参见 RFC 2965）。关于如何在这个参数使用相对路径的方法请参见这段。</p> <p>domain:例如 'example.com'， '.example.com' (包括所有子域名), 'subdomain.example.com'。如果没有定义，默认为当前文档位置的路径的域名部分 (string 或 null)。</p> <ol start="3"><li>检测 cookie</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>docCookies<span class="token punctuation">.</span><span class="token function">hasItem</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>检查一个 cookie 是否存在</p> <p>name:要检查的 cookie 名 (string).</p> <ol start="4"><li>得到所有 cookie 的列表</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>docCookies<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>返回一个这个路径所有可读的 cookie 的数组。</p> <p>示例用法:</p> <div class="language-js extra-class"><pre class="language-js"><code>docCookies<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;test0&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello world!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
docCookies<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>
  <span class="token string">&quot;test1&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Unicode test: \u00E0\u00E8\u00EC\u00F2\u00F9&quot;</span><span class="token punctuation">,</span>
  <span class="token number">Infinity</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
docCookies<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;test2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello world!&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">2020</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
docCookies<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;test3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello world!&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">2027</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;/blog&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
docCookies<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;test4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello world!&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Sun, 06 Nov 2022 21:43:15 GMT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
docCookies<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>
  <span class="token string">&quot;test5&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Hello world!&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Tue, 06 Dec 2022 13:11:07 GMT&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;/home&quot;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
docCookies<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;test6&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello world!&quot;</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
docCookies<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;test7&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello world!&quot;</span><span class="token punctuation">,</span> <span class="token number">245</span><span class="token punctuation">,</span> <span class="token string">&quot;/content&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
docCookies<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;test8&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello world!&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;example.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
docCookies<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;test9&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello world!&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
docCookies<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;test1;=&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Safe character test;=&quot;</span><span class="token punctuation">,</span> <span class="token number">Infinity</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>docCookies<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>docCookies<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&quot;test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>docCookies<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&quot;test5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
docCookies<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">&quot;test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
docCookies<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">&quot;test5&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/home&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>docCookies<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&quot;test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>docCookies<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&quot;test5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>docCookies<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&quot;unexistingCookie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>docCookies<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>docCookies<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&quot;test1;=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="sessionstorage-localstorage"><a href="#sessionstorage-localstorage" class="header-anchor">#</a> <strong>SessionStorage LocalStorage</strong></h2> <p>SessionStorage， LocalStorage， Cookie 这三者都可以被用来在浏览器端存储数据，而且都是字符串类型的键值对。区别
在于前两者属于 HTML5 WebStorage，创建它们的目的便于客户端存储数据。而 cookie 是网站为了标示用户身份而储存在用户
本地终端上的数据（通常经过加密）。cookie 数据始终在同源（协议、主机、端口相同）的 http 请求中携带（即使不需要），会
在浏览器和服务器间来回传递。</p> <p>存储大小：
cookie 数据大小不能超过 4 k 。
sessionStorage 和 localStorage 虽然也有存储大小的限制，但比 cookie 大得多，可以达到 5M 或更大。</p> <p>有期时间：
localStorage 存储持久数据，浏览器关闭后数据不丢失除非主动删除数据。
sessionStorage 数据在页面会话结束时会被清除。页面会话在浏览器打开期间一直保持，并且重新加载或恢复页面仍会
保持原来的页面会话。在新标签或窗口打开一个页面时会在顶级浏览上下文中初始化一个新的会话。
cookie 设置的 cookie 过期时间之前一直有效，即使窗口或浏览器关闭。</p> <p>作用域：
sessionStorage 只在同源的同窗口（或标签页）中共享数据，也就是只在当前会话中共享。
localStorage 在所有同源窗口中都是共享的。
cookie 在所有同源窗口中都是共享的。</p> <p>cookie 其实最开始是服务器端用于记录用户状态的一种方式，由服务器设置，在客户端存储，然后每次发起同源请求时，发送给服
务器端。cookie 最多能存储 4 k 数据，它的生存时间由 expires 属性指定，并且 cookie 只能被同源的页面访问共享。</p> <p>sessionStorage 是 html5 提供的一种浏览器本地存储的方法，它借鉴了服务器端 session 的概念，代表的是一次会话中所保
存的数据。它一般能够存储 5M 或者更大的数据，它在当前窗口关闭后就失效了，并且 sessionStorage 只能被同一个窗口的同源
页面所访问共享。</p> <p>localStorage 也是 html5 提供的一种浏览器本地存储的方法，它一般也能够存储 5M 或者更大的数据。它和 sessionStorage
不同的是，除非手动删除它，否则它不会失效，并且 localStorage 也只能被同源页面所访问共享。</p> <p>上面几种方式都是存储少量数据的时候的存储方式，当我们需要在本地存储大量数据的时候，我们可以使用浏览器的 indexDB 这是浏
览器提供的一种本地的数据库存储机制。它不是关系型数据库，它内部采用对象仓库的形式存储数据，它更接近 NoSQL 数据库。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">STORAGE_KEY</span> <span class="token operator">=</span> <span class="token string">&quot;mall&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// 存储值</span>
  <span class="token function">setItem</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> module_name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>module_name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> val <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>module_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
      val<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>module_name<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> val <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      val<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
      window<span class="token punctuation">.</span>sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token constant">STORAGE_KEY</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 获取某一个模块下面的属性user下面的userName</span>
  <span class="token function">getItem</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> module_name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>module_name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> val <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>module_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token keyword">return</span> val<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">getStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token constant">STORAGE_KEY</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;{}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">clear</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> module_name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> val <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>module_name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>val<span class="token punctuation">[</span>module_name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token keyword">delete</span> val<span class="token punctuation">[</span>module_name<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">delete</span> val<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    window<span class="token punctuation">.</span>sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token constant">STORAGE_KEY</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="缓存"><a href="#缓存" class="header-anchor">#</a> <strong>缓存</strong></h2> <p><a href="https://juejin.im/entry/5ad86c16f265da505a77dca4" target="_blank" rel="noopener noreferrer">彻底理解浏览器的缓存机制|掘金<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>HTTP 缓存分为强制缓存和协商缓存。</p> <p>浏览器请求资源时</p> <ol><li><p>先判断浏览器有没有缓存，若没缓存则向服务器请求资源</p></li> <li><p>若有缓存，根据 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cache-Control" target="_blank" rel="noopener noreferrer">Cache-Control<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>: max-age 或是 Expires 判断资源是否过期。</p> <ol><li>如果资源没过期，则直接从缓存读取（强制缓存），此时在 Network 一栏可以看到资源对应的状态码为 200（from disk cache）或者是 200 （from memory cache）</li></ol> <p>比如，资源没过期的时候我们打开新的页面，资源会从硬盘缓存中读取（from disk cache）；如果我们此时又刷新页面，资源会从内存缓存中读取（from memory cache）</p> <ol start="2"><li><p>如果资源过期了</p> <ol><li><p>查看上次资源的响应是否有 Etag 头部， 有的话发送请求，请求头为 If-None-Match</p></li> <li><p>没有 Etag 的话，看上次资源的响应是否有 Last-Modified，有的话发送请求，请求头为 If-Modified-Since。</p></li> <li><p>如果命中了缓存，或者说资源没有发生改变，服务器会发送状态码为 304（Not Modify） 的响应，告诉浏览器读取缓存中的资源。</p></li></ol> <p>如果未命中缓存，或者说资源发生了改变，服务器会发送状态码为 200（OK）的响应，并把资源作为响应的内容发送给浏览器。</p></li></ol></li></ol> <h3 id="etag"><a href="#etag" class="header-anchor">#</a> ETag</h3> <ol><li>一些文件也许会周期性的更改，但是他的内容并不改变(仅仅改变的修改时间)，这个时候我们并不希望客户端认为这个文件被修改了，而重新 GET；</li> <li>某些文件修改非常频繁，比如在秒以下的时间内进行修改，(比方说 1s 内修改了 N 次)，If-Modified-Since 能检查到的粒度是 s 级的，这种修改无法判断(或者说 UNIX 记录 MTIME 只能精确到秒)；</li> <li>某些服务器不能精确的得到文件的最后修改时间。</li></ol> <h2 id="跨域"><a href="#跨域" class="header-anchor">#</a> <strong>跨域</strong></h2> <p>跨域的访问会带来许多安全性的问题，比如，cookie 一般用于状态控制，常用于存储登录的信息，如果允许跨域访问，那么别的网站只需要一段脚本就可以获取你的 cookie，从而冒充你的身份去登录网站，造成非常大的安全问题，因此，现代浏览器均推行同源策略。</p> <h3 id="同源策略限制范围"><a href="#同源策略限制范围" class="header-anchor">#</a> 同源策略限制范围</h3> <ul><li>Cookie、LocalStorage 和 IndexDB 无法读取</li> <li>DOM 无法获得</li> <li>AJAX 请求不能发送</li></ul> <h3 id="jsonp"><a href="#jsonp" class="header-anchor">#</a> JSONP</h3> <p>原理：</p> <p>利用 script 标签可跨域的特点，在跨域脚本中可以直接回调当前脚本的函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token keyword">function</span> <span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;....../data.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token comment">//data.js</span>
<span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>在开发中可能会遇到多个 JSONP 请求的回调函数名是相同的，这时候就需要自己封装一个 JSONP:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> jsonpCallback<span class="token punctuation">,</span> success</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span>
  script<span class="token punctuation">.</span>async <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">&quot;text/javascript&quot;</span><span class="token punctuation">;</span>
  window<span class="token punctuation">[</span>jsonpCallback<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    success <span class="token operator">&amp;&amp;</span> <span class="token function">success</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;callback&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="cors"><a href="#cors" class="header-anchor">#</a> CORS</h3> <p><a href="http://www.ruanyifeng.com/blog/2016/04/cors.html" target="_blank" rel="noopener noreferrer">跨域资源共享 CORS 详解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>只需要后端在响应头设置 <code>Access-Control-Allow-Origin: *</code>， <code>*</code>为任意 <code>Origin</code>，也可以指定 <code>Origin</code></p> <p>使用 <code>CORS</code> 时默认不发送 <code>Cookie</code>，想要发送 <code>Cookie</code> 需要:</p> <ol><li>设置 <code>Access-Control-Allow-Credentials: true</code></li> <li><code>Access-Control-Allow-Origin</code> 不能设置为 <code>*</code> ，必须指定 <code>Origin</code></li></ol> <p>浏览器把请求分为简单请求与非简单请求</p> <p>简单请求必须满足以下两大条件</p> <ol><li>请求方法为 HEAD / GET / POST</li> <li>HTTP 头部不超过以下几种
<code>Accept</code> <code>Accept-Language</code> <code>Content-Language</code> <code>Last-Event-ID</code> <code>Content-Type</code>：只限于三个值 <code>application/x-www-form-urlencoded</code>、<code>multipart/form-data</code>、<code>text/plain</code>
不满足的就为非简单请求。</li></ol> <p>非简单请求的 CORS 请求，会在正式通信之前，增加一次 HTTP 查询请求，称为&quot;预检&quot;请求。</p> <p>这个请求的请求方法为 OPTIONS ，预检请求的头部还会包括以下几个字段</p> <p><code>Origin</code></p> <p><code>Access-Control-Request-Method</code> 用来表示非简单请求的请求方法</p> <p><code>Access-Control-Request-Headers</code> 用来表示非简单请求的额外头部，例如自定义头部</p> <h4 id="为什么要预检"><a href="#为什么要预检" class="header-anchor">#</a> 为什么要预检</h4> <p>对那些可能对服务器数据产生副作用的 HTTP 请求方法（特别是 GET 以外的 HTTP 请求，或者搭配某些 MIME 类型的 POST 请求），浏览器必须首先使用 OPTIONS 方法发起一个预检请求（preflight request），从而获知服务端是否允许该跨域请求。服务器确认允许之后，才发起实际的 HTTP 请求。在预检请求的返回中，服务器端也可以通知客户端，是否需要携带身份凭证（包括 Cookies 和 HTTP 认证相关数据）。</p> <h3 id="proxy-接口代理"><a href="#proxy-接口代理" class="header-anchor">#</a> proxy 接口代理</h3> <h3 id="location-hash"><a href="#location-hash" class="header-anchor">#</a> location.hash</h3> <p>这个方法也是主要用于父窗口和 iframe 窗口的通信。</p> <p>特点：如果只是改变片段标识符(fragment/hash)，页面不会重新刷新。</p> <p>实现跨域：</p> <p>父窗口修改 iframe 窗口的 src</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 父窗口</span>
<span class="token keyword">let</span> src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>originUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">##</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;iframe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>
</code></pre></div><p>iframe 窗口的页面不会刷新，但是能知道 hash 的变化</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// iframe 窗口</span>
window<span class="token punctuation">.</span><span class="token function-variable function">onhashchange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>同理，iframe 窗口也可以改变父窗口的 hash 来实现通信。</p> <h3 id="postmessage"><a href="#postmessage" class="header-anchor">#</a> postMessage</h3> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/postMessage" target="_blank" rel="noopener noreferrer">window.postMessage|MDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 窗口A中</span>
window<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://A.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 窗口B中</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// http://A.com</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// A 对象window引用</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 数据</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="websocket-跨域通信"><a href="#websocket-跨域通信" class="header-anchor">#</a> WebSocket 跨域通信</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">&quot;wss://echo.websoket.org&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//这个是后端端口</span>

ws<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;some message&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;连接关闭&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="document-domain"><a href="#document-domain" class="header-anchor">#</a> document.domain</h3> <p>该方式只能用于二级域名相同的情况下，比如 a.test.com 和 b.test.com 适用于该方式。</p> <p>只需要给页面添加 document.domain = 'test.com' 表示二级域名都相同就可以实现跨域</p> <h3 id="window-name"><a href="#window-name" class="header-anchor">#</a> window.name</h3> <p>这个方法主要用于父窗口和 iframe 窗口的通信。</p> <p>如果父窗口和 iframe 窗口是不同源的，则通常无法进行通信。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 我是父窗口 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>xxx.com<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">&lt;!-- 我是子窗口 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>window.name 特点：无论是否同源，只要在同一个窗口里，前一个网页设置了这个属性，后一个网页可以读取它。</p> <p>例如，我们在 a.com 页面下设置</p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">;</span>
location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&quot;b.com&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>然后在 b.com 也能获取到 window.name 的值。</p> <p>实现跨域：</p> <p>使用时，先设置 iframe 的 src 为我们想要通信的目标页面。当目标页面的 window.name 修改时，将我们的 iframe 的 src 修改为一个和父窗口同源的页面。</p> <p>本质：</p> <p>iframe 内的目标页面 &lt;=&gt; iframe 内的一个和父窗口同源的页面 &lt;=&gt; 父窗口</p> <h2 id="seo"><a href="#seo" class="header-anchor">#</a> <strong>SEO</strong></h2> <h3 id="seo-2"><a href="#seo-2" class="header-anchor">#</a> SEO</h3> <ol><li>合理的 title、description、keywords：搜索对着三项的权重逐个减小，title 值强调重点即可，重要关键词出现不要超过 2 次，而且要靠前，不同页面 title 要有所不同；description 把页面内容高度概括，长度合适，不可过分堆砌关键词，不同页面 description 有所不同；keywords 列举出重要关键词即可</li> <li>语义化的 HTML 代码，符合 W3C 规范：语义化代码让搜索引擎容易理解网页</li> <li>重要内容 HTML 代码放在最前：搜索引擎抓取 HTML 顺序是从上到下，有的搜索引擎对抓取长度有限制，保证重要内容一定会被抓取重要内容不要用 js 输出：爬虫不会执行 js 获取内容</li> <li>少用 iframe：搜索引擎不会抓取 iframe 中的内容</li> <li>非装饰性图片必须加 alt</li> <li>提高网站速度：网站速度是搜索引擎排序的一个重要指标</li></ol> <h2 id="模块化"><a href="#模块化" class="header-anchor">#</a> <strong>模块化</strong></h2> <h3 id="组件化与模块化的区别"><a href="#组件化与模块化的区别" class="header-anchor">#</a> 组件化与模块化的区别</h3> <p>组件化：针对的是页面中的整个完整的功能模块，划分成浏览器可以识别的每个模块，例如头部 Header、底部 Footer、Banner。优点：代码复用、便于维护。</p> <p>模块化：就是系统功能分离或独立的功能部分的方法，一般指的是单一的某个东西，例如：js、css</p> <h3 id="commonjs："><a href="#commonjs：" class="header-anchor">#</a> CommonJS：</h3> <ol><li><p>require 输入其他模块提供的功能</p></li> <li><p>module.exports 规范模块对外接口，输出一个值的拷贝。</p></li> <li><p>输出之后不能改变，会缓存起来</p></li> <li><p>自上而下同步进行 会阻塞 用在服务端</p></li></ol> <p>使用模块：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// moduleA.js</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">&quot;weiqinl&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">,</span>
  foo
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// moduleB.js</span>
<span class="token keyword">var</span> ma <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./moduleA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可以省略后缀.js</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">bar</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ma<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;weiqinl&quot;</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
  ma<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行foo方法</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// moduleC.js</span>
<span class="token keyword">var</span> mb <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./moduleB&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mb<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="amd"><a href="#amd" class="header-anchor">#</a> AMD</h3> <ol><li><p>define 定义模块.</p></li> <li><p>require 用于输入其他模块提供的功能.</p></li> <li><p>return 规范模块对外接口。</p></li> <li><p>define.amd 是一个对象，表明函数遵守 AMD 规范。AMD 的运行逻辑是，提前加载，提前执行，申明依赖模块的时候，会第一时间加载并执行模块内的代码，使后面的回调函数能在所需的环境中运行。</p></li> <li><p>异步加载文件 不会阻塞 用在浏览器端</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// moduleA.js</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'jQuery'</span><span class="token punctuation">,</span><span class="token string">'lodash'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">$<span class="token punctuation">,</span> _</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'weiqinl'</span><span class="token punctuation">,</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">return</span> <span class="token punctuation">{</span>
name<span class="token punctuation">,</span>
foo
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// index.js</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'moduleA'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
a<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'weiqinl'</span> <span class="token comment">// true</span>
a<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 执行A模块中的foo函数</span>
<span class="token comment">// do sth...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// index.html</span>
<span class="token comment">// HTML，需要在页面中引入 require.js 文件。</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;js/require.js&quot;</span> data<span class="token operator">-</span>main<span class="token operator">=</span><span class="token string">&quot;js/index&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script
</code></pre></div><h3 id="cmd"><a href="#cmd" class="header-anchor">#</a> CMD</h3> <ol><li><p>define 全局函数，定义模块</p></li> <li><p>通过 exports 向外提供接口</p></li> <li><p>用 require 获取接口，使用某个组件时用 use()调用。通过 require 引入的模块，只有当程序运行到这里时候才会加载执行</p></li> <li><p>主要在浏览器中运行，</p></li></ol> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token comment">// moduleA.js</span>
<span class="token comment">// 定义模块</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">var</span> <span class="token function-variable function">func</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./a'</span><span class="token punctuation">)</span> <span class="token comment">// 到此才会加载 a 模块</span>
a<span class="token punctuation">.</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./b'</span><span class="token punctuation">)</span> <span class="token comment">// 到此才会加载 b 模块</span>
b<span class="token punctuation">.</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// do sth...</span>
exports<span class="token punctuation">.</span>func <span class="token operator">=</span> func<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// index.js</span>
<span class="token comment">// 加载使用模块</span>
seajs<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'moduleA.js'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">ma</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">var</span> ma <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// HTML，需要在页面中引入 sea.js 文件。</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;./js/sea.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;./js/index.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h3 id="es6-module"><a href="#es6-module" class="header-anchor">#</a> ES6 Module</h3> <p>ES6 模块功能主要由两个命令构成：import 和 export。import 命令用于输入其他模块提供的功能。export 命令用于规范模块的对外接口。</p> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token comment">// 输出变量</span>
<span class="token keyword">export</span> <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'weiqinl'</span>
<span class="token keyword">export</span> <span class="token keyword">var</span> year <span class="token operator">=</span> <span class="token string">'2018'</span>
<span class="token comment">// 输出一个对象（推荐）</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'weiqinl'</span>
<span class="token keyword">var</span> year <span class="token operator">=</span> <span class="token string">'2018'</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> year<span class="token punctuation">}</span>
<span class="token comment">// 输出函数或类</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// export default 命令</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 正常命令</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> year <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./module.js'</span> <span class="token comment">//后缀.js不能省略</span>
<span class="token comment">// 如果遇到export default命令导出的模块</span>
<span class="token keyword">import</span> ed <span class="token keyword">from</span> <span class="token string">'./export-default.js'</span>
</code></pre></div><h3 id="amd-和-cmd-区别"><a href="#amd-和-cmd-区别" class="header-anchor">#</a> AMD 和 CMD 区别</h3> <ol><li>对于依赖的模块，AMD 是提前执行，CMD 是延迟执行。不过 RequireJS 从 2.0 开始，也改成了可以延迟执行（根据写法不同，执行的方式不同）</li> <li>CMD 推崇就近依赖，AMD 推崇依赖前置。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//CMD 的方式</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exprots<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  a<span class="token punctuation">.</span><span class="token function">dosmting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//省略 1W 行</span>
  <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  b<span class="token punctuation">.</span><span class="token function">dosmting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//AMD 的方式</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;./a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;./b&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">.</span><span class="token function">dosmting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//省略 1W 行</span>
  b<span class="token punctuation">.</span><span class="token function">dosmting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>以上 AMD 的写法是官方推崇的方式，但是同时也支持 CMD 的写法</p> <ol start="3"><li>AMD 支持全局 require、局部 require，但是 CMD 不支持全局 require，所以 CMD 没有全局 API 而 AMD 有</li></ol> <h3 id="commonjs-和-es6-module-的区别"><a href="#commonjs-和-es6-module-的区别" class="header-anchor">#</a> CommonJS 和 ES6 Module 的区别</h3> <ol><li><p>CommonJS : <code>module.exports(批量)，exports</code> 导出，<code>require</code> 导入
ES6 : <code>export</code> 导出，<code>import</code> 导入</p></li> <li><p>CommonJS：动态引入，执行时引入，可以写在判断里
ES6 Module：静态引入，编译时引入；只有 ES6 Module 才能静态分析，实现 Tree-Shaking</p></li> <li><p>CommonJS 不会提升 require
ES6 在编译期间会将所有 import 提升到顶部，</p></li> <li><p>CommonJS 导出的是一个值拷贝，会对加载结果进行缓存，一旦内部再修改这个值，则不会同步到外部，如果想更新值，必须重新导入一次
ES6 是导出的一个引用，导入导出的值都指向同一个内存地址，所以导入值会跟随导出值变化</p></li> <li><p>CommonJS ：顶层的 this 指向当前
ES6 ：顶层 this 指向 undefined</p></li> <li><p>CommonJS：同步导入，因为用于服务端，文件都在本地，同步导入即使卡住主线程影响也不大
ES6 Module：异步导入，因为用于浏览器，需要下载文件，如果也采用同步导入会对渲染有很大影响</p></li> <li><p>ES6 Module 兼容性不好，在 webpack 中会经过 Babel 编译成 require/exports 来执行的</p></li></ol> <h2 id="websocket"><a href="#websocket" class="header-anchor">#</a> <strong>webSocket</strong></h2> <h3 id="实现浏览器内多个标签页之间的通信"><a href="#实现浏览器内多个标签页之间的通信" class="header-anchor">#</a> 实现浏览器内多个标签页之间的通信</h3> <ol><li><p>使用 WebSocket，通信的标签页连接同一个服务器，发送消息到服务器后，服务器推送消息给所有连接的客户端。</p></li> <li><p>使用 SharedWorker （只在 chrome 浏览器实现了），两个页面共享同一个线程，通过向线程发送数据和接收数据来实现标
签页之间的双向通行。</p></li> <li><p>可以调用 localStorage、cookies 等本地存储方式，localStorge 另一个浏览上下文里被添加、修改或删除时，它都会触
发一个 storage 事件，我们通过监听 storage 事件，控制它的值来进行页面信息通信；</p></li> <li><p>如果我们能够获得对应标签页的引用，通过 postMessage 方法也是可以实现多个标签页通信的。</p></li></ol> <h2 id="场景"><a href="#场景" class="header-anchor">#</a> <strong>场景</strong></h2> <h3 id="页面上实现一个圆形的可点击区域"><a href="#页面上实现一个圆形的可点击区域" class="header-anchor">#</a> 页面上实现一个圆形的可点击区域</h3> <ol><li><p>纯 html 实现，使用 <area> 来给 <img> 图像标记热点区域的方式，<map> 标签用来定义一个客户端图像映射，<area>标签用来定义图像映射中的区域，area 元素永远嵌套在 map 元素内部，我们可以将 area 区域设置为圆形，从而实现可点击的圆形区域。</map></p></li> <li><p>纯 css 实现，使用 border-radius ，当 border-radius 的长度等于宽高相等的元素值的一半时，即可实现一个圆形的点击区域。</p></li> <li><p>纯 js 实现，判断一个点在不在圆上的简单算法，通过监听文档的点击事件，获取每次点击时鼠标的位置，判断该位置是否在我们规定的圆形区域内。</p></li></ol> <h3 id="一个列表，假设有-100000-个数据"><a href="#一个列表，假设有-100000-个数据" class="header-anchor">#</a> 一个列表，假设有 100000 个数据</h3> <p>解决办法：</p> <p>（1）将数据分页，利用分页的原理，每次服务器端只返回一定数目的数据，浏览器每次只对一部分进行加载。</p> <p>（2）使用懒加载的方法，每次加载一部分数据，其余数据当需要使用时再去加载。</p> <p>（3）使用数组分块技术，基本思路是为要处理的项目创建一个队列，然后设置定时器每过一段时间取出一部分数据，然后再使用定
时器取出下一个要处理的项目进行处理，接着再设置另一个定时器。</p> <h3 id="渲染几万条数据并不卡住界面"><a href="#渲染几万条数据并不卡住界面" class="header-anchor">#</a> 渲染几万条数据并不卡住界面</h3> <p>执行一个动画，并且要求浏览器在下次重绘之前调用指定的回调函数更新动画。该方法需要传入一个回调函数作为参数，该回调函数会在浏览器下一次重绘之前执行</p> <p>在不卡住页面的情况下渲染数据，也就是说不能一次性将几万条都渲染出来，而应该一次渲染部分 DOM，那么就可以通过 <code>requestAnimationFrame</code> 来每 16 ms 刷新一次。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ie=edge<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
      控件
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 插入十万条数据</span>
        <span class="token keyword">const</span> total <span class="token operator">=</span> <span class="token number">100000</span><span class="token punctuation">;</span>
        <span class="token comment">// 一次插入 20 条，如果觉得性能不好就减少</span>
        <span class="token keyword">const</span> once <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
        <span class="token comment">// 渲染数据总共需要几次</span>
        <span class="token keyword">const</span> loopCount <span class="token operator">=</span> total <span class="token operator">/</span> once<span class="token punctuation">;</span>
        <span class="token keyword">let</span> countOfRender <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;ul&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 优化性能，插入不会造成回流</span>
          <span class="token keyword">const</span> fragment <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> once<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;li&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            li<span class="token punctuation">.</span>innerText <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> total<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fragment<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          ul<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
          countOfRender <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
          <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">function</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>countOfRender <span class="token operator">&lt;</span> loopCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></div> <footer class="page-edit" style="display:none;"><!----> <!----></footer> <!----></main> <!----> <div style="display:none;" data-v-418054de data-v-418054de><div class="comments-wrapper" data-v-418054de><!----></div></div></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-1e128e82 data-v-1e128e82><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-1e128e82><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-1e128e82></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-1e128e82></path></svg></div></div></div>
    <script src="/assets/js/app.8e528a8b.js" defer></script><script src="/assets/js/3.82a49c19.js" defer></script><script src="/assets/js/1.0ab98803.js" defer></script><script src="/assets/js/26.3968f588.js" defer></script>
  </body>
</html>
